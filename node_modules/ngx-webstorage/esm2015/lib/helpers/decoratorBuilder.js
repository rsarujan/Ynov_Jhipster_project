import { StrategyIndex } from '../services/strategyIndex';
import { StorageKeyManager } from './storageKeyManager';
import { noop } from './noop';
export class DecoratorBuilder {
    static buildSyncStrategyDecorator(strategyName, prototype, propName, key, defaultValue = null) {
        const rawKey = key || propName;
        let storageKey;
        Object.defineProperty(prototype, propName, {
            get: function () {
                let value;
                StrategyIndex.get(strategyName).get(getKey()).subscribe((result) => value = result);
                return value === undefined ? defaultValue : value;
            },
            set: function (value) {
                StrategyIndex.get(strategyName).set(getKey(), value).subscribe(noop);
            }
        });
        function getKey() {
            if (storageKey !== undefined)
                return storageKey;
            return storageKey = StorageKeyManager.normalize(rawKey);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb3JhdG9yQnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC13ZWJzdG9yYWdlLyIsInNvdXJjZXMiOlsibGliL2hlbHBlcnMvZGVjb3JhdG9yQnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sMkJBQTJCLENBQUM7QUFFeEQsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLFFBQVEsQ0FBQztBQUU1QixNQUFNLE9BQU8sZ0JBQWdCO0lBRTVCLE1BQU0sQ0FBQywwQkFBMEIsQ0FBQyxZQUF3QyxFQUFFLFNBQVMsRUFBRSxRQUFnQixFQUFFLEdBQVksRUFBRSxlQUFvQixJQUFJO1FBQzlJLE1BQU0sTUFBTSxHQUFXLEdBQUcsSUFBSSxRQUFRLENBQUM7UUFDdkMsSUFBSSxVQUFrQixDQUFDO1FBRXZCLE1BQU0sQ0FBQyxjQUFjLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRTtZQUMxQyxHQUFHLEVBQUU7Z0JBQ0osSUFBSSxLQUFVLENBQUM7Z0JBQ2YsYUFBYSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsQ0FBQztnQkFDcEYsT0FBTyxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztZQUNuRCxDQUFDO1lBQ0QsR0FBRyxFQUFFLFVBQVMsS0FBSztnQkFDbEIsYUFBYSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RFLENBQUM7U0FDRCxDQUFDLENBQUM7UUFFSCxTQUFTLE1BQU07WUFDZCxJQUFJLFVBQVUsS0FBSyxTQUFTO2dCQUFFLE9BQU8sVUFBVSxDQUFDO1lBQ2hELE9BQU8sVUFBVSxHQUFHLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN6RCxDQUFDO0lBQ0YsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtTdHJhdGVneUluZGV4fSBmcm9tICcuLi9zZXJ2aWNlcy9zdHJhdGVneUluZGV4JztcbmltcG9ydCB7U3RvcmFnZVN0cmF0ZWdpZXN9IGZyb20gJy4uL2NvbnN0YW50cy9zdHJhdGVneSc7XG5pbXBvcnQge1N0b3JhZ2VLZXlNYW5hZ2VyfSBmcm9tICcuL3N0b3JhZ2VLZXlNYW5hZ2VyJztcbmltcG9ydCB7bm9vcH0gZnJvbSAnLi9ub29wJztcblxuZXhwb3J0IGNsYXNzIERlY29yYXRvckJ1aWxkZXIge1xuXHRcblx0c3RhdGljIGJ1aWxkU3luY1N0cmF0ZWd5RGVjb3JhdG9yKHN0cmF0ZWd5TmFtZTogc3RyaW5nIHwgU3RvcmFnZVN0cmF0ZWdpZXMsIHByb3RvdHlwZSwgcHJvcE5hbWU6IHN0cmluZywga2V5Pzogc3RyaW5nLCBkZWZhdWx0VmFsdWU6IGFueSA9IG51bGwpIHtcblx0XHRjb25zdCByYXdLZXk6IHN0cmluZyA9IGtleSB8fCBwcm9wTmFtZTtcblx0XHRsZXQgc3RvcmFnZUtleTogc3RyaW5nO1xuXHRcdFxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGUsIHByb3BOYW1lLCB7XG5cdFx0XHRnZXQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRsZXQgdmFsdWU6IGFueTtcblx0XHRcdFx0U3RyYXRlZ3lJbmRleC5nZXQoc3RyYXRlZ3lOYW1lKS5nZXQoZ2V0S2V5KCkpLnN1YnNjcmliZSgocmVzdWx0KSA9PiB2YWx1ZSA9IHJlc3VsdCk7XG5cdFx0XHRcdHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gZGVmYXVsdFZhbHVlIDogdmFsdWU7XG5cdFx0XHR9LFxuXHRcdFx0c2V0OiBmdW5jdGlvbih2YWx1ZSkge1xuXHRcdFx0XHRTdHJhdGVneUluZGV4LmdldChzdHJhdGVneU5hbWUpLnNldChnZXRLZXkoKSwgdmFsdWUpLnN1YnNjcmliZShub29wKTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRcblx0XHRmdW5jdGlvbiBnZXRLZXkoKSB7XG5cdFx0XHRpZiAoc3RvcmFnZUtleSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gc3RvcmFnZUtleTtcblx0XHRcdHJldHVybiBzdG9yYWdlS2V5ID0gU3RvcmFnZUtleU1hbmFnZXIubm9ybWFsaXplKHJhd0tleSk7XG5cdFx0fVxuXHR9XG59XG5cbiJdfQ==