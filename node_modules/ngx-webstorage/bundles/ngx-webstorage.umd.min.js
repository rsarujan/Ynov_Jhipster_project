!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("@angular/core"),require("rxjs"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-webstorage",["exports","rxjs/operators","@angular/core","rxjs","@angular/common"],t):t((e=e||self)["ngx-webstorage"]={},e.rxjs.operators,e.ng.core,e.rxjs,e.ng.common)}(this,(function(e,t,r,n,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function a(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s;function c(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}function u(e,t){return function(r,n){t(r,n,e)}}function f(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function g(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function l(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}(s=e.StorageStrategies||(e.StorageStrategies={})).Local="local_strategy",s.Session="session_strategy",s.InMemory="in_memory_strategy";var p=function(){function e(){}return e.isStorageAvailable=function(e){var t=!0;try{"object"==typeof e?(e.setItem("test-storage","foobar"),e.removeItem("test-storage")):t=!1}catch(e){t=!1}return t},e}();function y(){}var h=function(){function e(){}return e.normalize=function(t){return t=e.isCaseSensitive?t:t.toLowerCase(),""+e.prefix+e.separator+t},e.isNormalizedKey=function(t){return 0===t.indexOf(e.prefix+e.separator)},e.setPrefix=function(t){e.prefix=t},e.setSeparator=function(t){e.separator=t},e.setCaseSensitive=function(t){e.isCaseSensitive=t},e.consumeConfiguration=function(e){"prefix"in e&&this.setPrefix(e.prefix),"separator"in e&&this.setSeparator(e.separator),"caseSensitive"in e&&this.setCaseSensitive(e.caseSensitive)},e.prefix="ngx-webstorage",e.separator="|",e.isCaseSensitive=!1,e}(),d=function(){function e(e){this.strategy=e}return e.prototype.retrieve=function(e){var t;return this.strategy.get(h.normalize(e)).subscribe((function(e){return t=void 0===e?null:e})),t},e.prototype.store=function(e,t){return this.strategy.set(h.normalize(e),t).subscribe(y),t},e.prototype.clear=function(e){void 0!==e?this.strategy.del(h.normalize(e)).subscribe(y):this.strategy.clear().subscribe(y)},e.prototype.getStrategyName=function(){return this.strategy.name},e.prototype.observe=function(e){var r=this;return e=h.normalize(e),this.strategy.keyChanges.pipe(t.filter((function(t){return null===t||t===e})),t.switchMap((function(){return r.strategy.get(e)})),t.distinctUntilChanged(),t.shareReplay())},e}(),v=function(){function e(e){this.strategy=e}return e.prototype.retrieve=function(e){return this.strategy.get(h.normalize(e)).pipe(t.map((function(e){return void 0===e?null:e})))},e.prototype.store=function(e,t){return this.strategy.set(h.normalize(e),t)},e.prototype.clear=function(e){return void 0!==e?this.strategy.del(h.normalize(e)):this.strategy.clear()},e.prototype.getStrategyName=function(){return this.strategy.name},e.prototype.observe=function(e){var r=this;return e=h.normalize(e),this.strategy.keyChanges.pipe(t.filter((function(t){return null===t||t===e})),t.switchMap((function(){return r.strategy.get(e)})),t.distinctUntilChanged(),t.shareReplay())},e}(),S=function(){function e(){this.caches={}}return e.prototype.get=function(e,t){return this.getCacheStore(e)[t]},e.prototype.set=function(e,t,r){this.getCacheStore(e)[t]=r},e.prototype.del=function(e,t){delete this.getCacheStore(e)[t]},e.prototype.clear=function(e){this.caches[e]={}},e.prototype.getCacheStore=function(e){return e in this.caches?this.caches[e]:this.caches[e]={}},e.ɵprov=r["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=c([r.Injectable({providedIn:"root"})],e)}(),m=new r.InjectionToken("window_local_storage");function b(){return"undefined"!=typeof window?window.localStorage:null}var I={provide:m,useFactory:b},j=new r.InjectionToken("window_session_storage");function x(){return"undefined"!=typeof window?window.sessionStorage:null}var w={provide:j,useFactory:x},C=function(){function e(e,t){this.storage=e,this.cache=t,this.keyChanges=new n.Subject}return Object.defineProperty(e.prototype,"isAvailable",{get:function(){return void 0===this._isAvailable&&(this._isAvailable=p.isStorageAvailable(this.storage)),this._isAvailable},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var t=this.cache.get(this.name,e);if(void 0!==t)return n.of(t);try{var r=this.storage.getItem(e);null!==r&&(t=JSON.parse(r),this.cache.set(this.name,e,t))}catch(e){console.warn(e)}return n.of(t)},e.prototype.set=function(e,t){var r=JSON.stringify(t);return this.storage.setItem(e,r),this.cache.set(this.name,e,t),this.keyChanges.next(e),n.of(t)},e.prototype.del=function(e){return this.storage.removeItem(e),this.cache.del(this.name,e),this.keyChanges.next(e),n.of(null)},e.prototype.clear=function(){return this.storage.clear(),this.cache.clear(this.name),this.keyChanges.next(null),n.of(null)},e}(),_=function(t){function n(e,r,n,a){var s=t.call(this,e,r)||this;return s.storage=e,s.cache=r,s.platformId=n,s.zone=a,s.name=i.strategyName,o.isPlatformBrowser(s.platformId)&&s.listenExternalChanges(),s}var i;return a(n,t),i=n,n.prototype.listenExternalChanges=function(){var e=this;window.addEventListener("storage",(function(t){return e.zone.run((function(){if(t.storageArea===e.storage){var r=t.key;null!==r?e.cache.del(e.name,t.key):e.cache.clear(e.name),e.keyChanges.next(r)}}))}))},n.strategyName=e.StorageStrategies.Local,n.ctorParameters=function(){return[{type:void 0,decorators:[{type:r.Inject,args:[m]}]},{type:S},{type:void 0,decorators:[{type:r.Inject,args:[r.PLATFORM_ID]}]},{type:r.NgZone}]},n=i=c([r.Injectable(),u(0,r.Inject(m)),u(2,r.Inject(r.PLATFORM_ID)),f("design:paramtypes",[Object,S,Object,r.NgZone])],n)}(C),O=function(t){function n(e,r,n,a){var s=t.call(this,e,r)||this;return s.storage=e,s.cache=r,s.platformId=n,s.zone=a,s.name=i.strategyName,o.isPlatformBrowser(s.platformId)&&s.listenExternalChanges(),s}var i;return a(n,t),i=n,n.prototype.listenExternalChanges=function(){var e=this;window.addEventListener("storage",(function(t){return e.zone.run((function(){if(t.storageArea===e.storage){var r=t.key;null!==t.key?e.cache.del(e.name,t.key):e.cache.clear(e.name),e.keyChanges.next(r)}}))}))},n.strategyName=e.StorageStrategies.Session,n.ctorParameters=function(){return[{type:void 0,decorators:[{type:r.Inject,args:[j]}]},{type:S},{type:void 0,decorators:[{type:r.Inject,args:[r.PLATFORM_ID]}]},{type:r.NgZone}]},n=i=c([r.Injectable(),u(0,r.Inject(j)),u(2,r.Inject(r.PLATFORM_ID)),f("design:paramtypes",[Object,S,Object,r.NgZone])],n)}(C),k=function(){function t(e){this.cache=e,this.keyChanges=new n.Subject,this.isAvailable=!0,this.name=o.strategyName}var o;return o=t,t.prototype.get=function(e){return n.of(this.cache.get(this.name,e))},t.prototype.set=function(e,t){return this.cache.set(this.name,e,t),this.keyChanges.next(e),n.of(t)},t.prototype.del=function(e){return this.cache.del(this.name,e),this.keyChanges.next(e),n.of(null)},t.prototype.clear=function(){return this.cache.clear(this.name),this.keyChanges.next(null),n.of(null)},t.strategyName=e.StorageStrategies.InMemory,t.ctorParameters=function(){return[{type:S,decorators:[{type:r.Inject,args:[S]}]}]},t=o=c([r.Injectable(),u(0,r.Inject(S)),f("design:paramtypes",[S])],t)}(),A=new r.InjectionToken("STORAGE_STRATEGIES"),R=[{provide:A,useClass:k,multi:!0},{provide:A,useClass:_,multi:!0},{provide:A,useClass:O,multi:!0}],P=function(){function e(e){this.keyChanges=new n.Subject,this.store={},this._available=!0,this.name=e||"stub_strategy"}return Object.defineProperty(e.prototype,"isAvailable",{get:function(){return this._available},enumerable:!0,configurable:!0}),e.prototype.get=function(e){return n.of(this.store[e])},e.prototype.set=function(e,t){return this.store[e]=t,this.keyChanges.next(e),n.of(t)},e.prototype.del=function(e){return delete this.store[e],this.keyChanges.next(e),n.of(null)},e.prototype.clear=function(){return this.store={},this.keyChanges.next(null),n.of(null)},e}(),N=function(){function e(){this.store={}}return Object.defineProperty(e.prototype,"length",{get:function(){return Object.keys(this.store).length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.store={}},e.prototype.getItem=function(e){return this.store[e]||null},e.prototype.key=function(e){return Object.keys(this.store)[e]},e.prototype.removeItem=function(e){delete this.store[e]},e.prototype.setItem=function(e,t){this.store[e]=t},e}(),E=function(){function t(e){this.strategies=e,this.registration$=new n.Subject,e||(e=[]),this.strategies=e.reverse().map((function(e,t,r){return e.name})).map((function(e,t,r){return r.indexOf(e)===t?t:null})).filter((function(e){return null!==e})).map((function(t){return e[t]}))}var o;return o=t,t.get=function(t){if(!this.isStrategyRegistered(t))throw Error("invalid_strategy");var r=this.index[t];return r.isAvailable||(r=this.index[e.StorageStrategies.InMemory]),r},t.set=function(e,t){this.index[e]=t},t.clear=function(e){void 0!==e?delete this.index[e]:this.index={}},t.isStrategyRegistered=function(e){return e in this.index},t.hasRegistredStrategies=function(){return Object.keys(this.index).length>0},t.prototype.getStrategy=function(e){return o.get(e)},t.prototype.indexStrategies=function(){var e=this;this.strategies.forEach((function(t){return e.register(t.name,t)}))},t.prototype.indexStrategy=function(e,t){if(void 0===t&&(t=!1),o.isStrategyRegistered(e)&&!t)return o.get(e);var r=this.strategies.find((function(t){return t.name===e}));if(!r)throw new Error("invalid_strategy");return this.register(e,r,t),r},t.prototype.register=function(e,t,r){void 0===r&&(r=!1),o.isStrategyRegistered(e)&&!r||(o.set(e,t),this.registration$.next(e))},t.index={},t.ctorParameters=function(){return[{type:Array,decorators:[{type:r.Optional},{type:r.Inject,args:[A]}]}]},t.ɵprov=r["ɵɵdefineInjectable"]({factory:function(){return new t(r["ɵɵinject"](A,8))},token:t,providedIn:"root"}),t=o=c([r.Injectable({providedIn:"root"}),u(0,r.Optional()),u(0,r.Inject(A)),f("design:paramtypes",[Array])],t)}(),L=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t}(d);function T(t){var r=t.indexStrategy(e.StorageStrategies.Local);return new d(r)}var z={provide:L,useFactory:T,deps:[E]},M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t}(d);function F(t){var r=t.indexStrategy(e.StorageStrategies.Session);return new d(r)}var D={provide:M,useFactory:F,deps:[E]},G=function(){function e(){}return e.buildSyncStrategyDecorator=function(e,t,r,n,o){void 0===o&&(o=null);var i,a=n||r;function s(){return void 0!==i?i:i=h.normalize(a)}Object.defineProperty(t,r,{get:function(){var t;return E.get(e).get(s()).subscribe((function(e){return t=e})),void 0===t?o:t},set:function(t){E.get(e).set(s(),t).subscribe(y)}})},e}();var Z=[z,D],q=new r.InjectionToken("ngx_webstorage_config");function B(e){return e.indexStrategies(),function(){return E.index}}var J=function(){function e(e,t){t?h.consumeConfiguration(t):console.error("NgxWebstorage : Possible misconfiguration (The forRoot method usage is mandatory since the 3.0.0)")}var t;return t=e,e.forRoot=function(e){return void 0===e&&(e={}),{ngModule:t,providers:l([{provide:q,useValue:e},I,w],Z,R,[{provide:r.APP_INITIALIZER,useFactory:B,deps:[E],multi:!0}])}},e.ctorParameters=function(){return[{type:E},{type:void 0,decorators:[{type:r.Optional},{type:r.Inject,args:[q]}]}]},e=t=c([r.NgModule({}),u(1,r.Optional()),u(1,r.Inject(q)),f("design:paramtypes",[E,Object])],e)}();e.AsyncStorage=v,e.CompatHelper=p,e.InMemoryStorageStrategy=k,e.InvalidStrategyError="invalid_strategy",e.LIB_CONFIG=q,e.LOCAL_STORAGE=m,e.LocalStorage=function(t,r){return function(n,o){G.buildSyncStrategyDecorator(e.StorageStrategies.Local,n,o,t,r)}},e.LocalStorageService=L,e.LocalStorageStrategy=_,e.NgxWebstorageModule=J,e.SESSION_STORAGE=j,e.STORAGE_STRATEGIES=A,e.SessionStorage=function(t,r){return function(n,o){G.buildSyncStrategyDecorator(e.StorageStrategies.Session,n,o,t,r)}},e.SessionStorageService=M,e.SessionStorageStrategy=O,e.StorageStrategyStub=P,e.StorageStrategyStubName="stub_strategy",e.StorageStub=N,e.StrategyCacheService=S,e.StrategyIndex=E,e.SyncStorage=d,e.appInit=B,e.ɵa=b,e.ɵb=I,e.ɵc=x,e.ɵd=w,e.ɵe=R,e.ɵf=T,e.ɵg=z,e.ɵh=F,e.ɵi=D,e.ɵj=C,e.ɵl=A,e.ɵn=Z,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-webstorage.umd.min.js.map